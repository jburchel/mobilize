{% extends "admin/base.html" %}

{% block title %}System Dashboard{% endblock %}

{% block page_title %}System Dashboard{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Admin</a></li>
<li class="breadcrumb-item active">System</li>
{% endblock %}

{% block content %}
<div class="row">
  <!-- System Stats Cards -->
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-primary shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">CPU Usage</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ system_stats.cpu_usage }}%</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-cpu fa-2x text-gray-300"></i>
          </div>
        </div>
        <div class="progress mt-2" style="height: 8px;">
          <div class="progress-bar" role="progressbar" style="width: {{ system_stats.cpu_usage }}%"
               aria-valuenow="{{ system_stats.cpu_usage }}" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-success shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Memory Usage</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ system_stats.memory_usage }}%</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-memory fa-2x text-gray-300"></i>
          </div>
        </div>
        <div class="progress mt-2" style="height: 8px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: {{ system_stats.memory_usage }}%"
               aria-valuenow="{{ system_stats.memory_usage }}" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-info shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Disk Usage</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ system_stats.disk_usage }}%</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-hdd fa-2x text-gray-300"></i>
          </div>
        </div>
        <div class="progress mt-2" style="height: 8px;">
          <div class="progress-bar bg-info" role="progressbar" style="width: {{ system_stats.disk_usage }}%"
               aria-valuenow="{{ system_stats.disk_usage }}" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-warning shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Database Size</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ system_stats.database_size }}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-database fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- System Management Cards Row -->
<div class="row">
  <!-- Database Management Card -->
  <div class="col-lg-4 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Database Management</h6>
        <a href="{{ url_for('admin.database_management') }}" class="btn btn-sm btn-primary">
          <i class="bi bi-gear"></i> Manage
        </a>
      </div>
      <div class="card-body">
        <div class="row mb-2">
          <div class="col-6 text-muted">Last Backup:</div>
          <div class="col-6 text-right">{{ system_stats.last_backup }}</div>
        </div>
        <div class="row mb-3">
          <div class="col-6 text-muted">Database Size:</div>
          <div class="col-6 text-right">{{ system_stats.database_size }}</div>
        </div>
        
        <div class="d-grid gap-2">
          <a href="{{ url_for('admin.database_logs') }}" class="btn btn-outline-primary">
            <i class="bi bi-journal-text"></i> View Database Logs
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Email Settings Card -->
  <div class="col-lg-4 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Email System</h6>
        <a href="{{ url_for('admin.email_settings') }}" class="btn btn-sm btn-primary">
          <i class="bi bi-gear"></i> Configure
        </a>
      </div>
      <div class="card-body">
        <p class="card-text">Configure email settings, manage templates, and monitor email delivery.</p>
        
        <div class="d-grid gap-2">
          <a href="{{ url_for('admin.email_logs') }}" class="btn btn-outline-primary">
            <i class="bi bi-envelope"></i> View Email Logs
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Google Workspace Card -->
  <div class="col-lg-4 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Google Workspace</h6>
        <a href="{{ url_for('admin.google_workspace_settings') }}" class="btn btn-sm btn-primary">
          <i class="bi bi-gear"></i> Configure
        </a>
      </div>
      <div class="card-body">
        <p class="card-text">Manage Google Workspace integration for email, calendar, and contacts sync.</p>
        
        <div class="d-grid gap-2">
          <a href="#" class="btn btn-outline-primary">
            <i class="bi bi-google"></i> Sync Status
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Logging and Security Row -->
<div class="row">
  <!-- Logging & Monitoring Card -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Logging & Monitoring</h6>
      </div>
      <div class="card-body">
        <p>View and analyze various system and application logs.</p>
        
        <div class="list-group">
          <a href="{{ url_for('admin.system_logs') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            System Logs
            <span class="badge bg-primary rounded-pill">24</span>
          </a>
          <a href="{{ url_for('admin.activity_logs') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Activity Logs
            <span class="badge bg-primary rounded-pill">67</span>
          </a>
          <a href="{{ url_for('admin.security_logs') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Security Logs
            <span class="badge bg-danger rounded-pill">3</span>
          </a>
          <a href="{{ url_for('admin.system_performance') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            System Performance
            <i class="bi bi-graph-up"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Recent Events Card -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Recent System Events</h6>
      </div>
      <div class="card-body">
        <div class="list-group">
          {% for event in recent_events %}
          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1">
                {% if event.type == 'backup' %}
                <i class="bi bi-save text-success me-2"></i>
                {% elif event.type == 'update' %}
                <i class="bi bi-arrow-up-circle text-primary me-2"></i>
                {% elif event.type == 'maintenance' %}
                <i class="bi bi-wrench text-info me-2"></i>
                {% elif event.type == 'error' %}
                <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                {% endif %}
                {{ event.details }}
              </h6>
              <small class="text-muted">{{ event.time }}</small>
            </div>
            <small class="text-{{ event.status }}">{{ event.type|upper }}</small>
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- System Info -->
<div class="card shadow mb-4">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">System Information</h6>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-light">
          <div class="card-body">
            <h6 class="card-title text-muted mb-2">App Uptime</h6>
            <p class="card-text h5">{{ system_stats.app_uptime }}</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-light">
          <div class="card-body">
            <h6 class="card-title text-muted mb-2">Server Uptime</h6>
            <p class="card-text h5">{{ system_stats.server_uptime }}</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-light">
          <div class="card-body">
            <h6 class="card-title text-muted mb-2">Python Version</h6>
            <p class="card-text h5">{{ system_stats.python_version }}</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-light">
          <div class="card-body">
            <h6 class="card-title text-muted mb-2">Flask Version</h6>
            <p class="card-text h5">{{ system_stats.flask_version }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Any additional JS for the system dashboard can go here
  });
</script>
{% endblock %} 